<%- include ('../parts/header') %> <%- include ('../parts/sidebar') %>

<div class="my-2 px-2">
  <div class="app-content content">
    <div class="content-wrapper">
      <div class="content-header row">
        <div class="content-header-left col-md-6 col-12 mb-2">
          <div class="row breadcrumbs-top">
            <div class="breadcrumb-wrapper col-12">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="">Home </a></li>
                <li class="breadcrumb-item"><a href="">Scopes</a></li>
                <li class="breadcrumb-item active">Create</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
      <div class="content-body">
        <!-- Basic form layout section start -->
        <section id="basic-form-layouts">
          <div class="row match-height">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">
                  <a class="heading-elements-toggle"
                    ><i class="la la-ellipsis-v font-medium-3"></i
                  ></a>
                  <div class="heading-elements">
                    <ul class="list-inline mb-0">
                      <li>
                        <a data-action="collapse"><i class="ft-minus"></i></a>
                      </li>
                      <li>
                        <a data-action="reload"><i class="ft-rotate-cw"></i></a>
                      </li>
                      <li>
                        <a data-action="expand"><i class="ft-maximize"></i></a>
                      </li>
                      <li>
                        <a data-action="close"><i class="ft-x"></i></a>
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="card-content collapse show">
                  <div class="card-body">
                    <form
                      class="form"
                      action="/admin/scope/update/<%= Scope._id %>"
                      method="POST"
                      enctype="multipart/form-data"
                    >
                      <div class="form-body">
                        <h4 class="form-section">
                          <i class="ft-home"></i> Scope Date
                        </h4>

                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-group">
                              <label>Scope area</label>
                              <input
                                type="text"
                                name="area"
                                class="form-control"
                                value="<%= Scope.area %> "
                              />
                            </div>
                          </div>

                          <div class="col-md-6">
                            <div class="form-group">
                                <label>Scope price</label>
                                <div class="input-group">
                                <input type="text" name="price"class="form-control" aria-describedby="sizing-addon2" value="<%= Scope.price %>" />
                                <div class="input-group-append">
                                  <span
                                    class="input-group-text"
                                    id="sizing-addon2"
                                    >LE</span>
                                
                              </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-4">
                            <div class="form-group">
                              <label>Scope image</label>
                              <input
                                type="file"
                                name="image"
                                class="form-control"
                              />
                            </div>
                          </div>
                          <div class="col-md-2">
                            <img
                              class="img-thumbnial"
                              src="/uploads/Scope/<%=  Scope.image %>"
                              height="80"
                              width="100"
                              alt=""
                            />
                          </div>
                        </div>

                        <div class="row hidden">
                          <div class="col-md-3">
                            <div class="form-group">
                              <label for="latitude"> latitude </label>
                              <input
                                type="text"
                                id="latitude"
                                class="form-control"
                                name="latitude"
                                value="<%= Scope.latitude %>"
                              />
                            </div>
                          </div>

                          <div class="col-md-3">
                            <div class="form-group">
                              <label for="longitude"> longitude </label>
                              <input
                                type="text"
                                id="longitude"
                                class="form-control"
                                name="longitude"
                                value="<%= Scope.longitude %>"
                              />
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md-12">
                            <div class="form-group">
                              <label for="projectinput1">Address</label>
                              <input type="text" id="pac-input" class="form-control" name="address" value="<%= Scope.address %>"/>

                              <div id="map" style="height: 500px"></div>
                            </div>
                          </div>
                        </div>

                        <script>
                                    var map, infoWindow;
                                    var geocoder;
                                    function initMap() {
                                      // Display a map on the page
                                      var map = new google.maps.Map(
                                        document.getElementById("map"),
                                        {
                                          center: { lat: 24.740691, lng: 46.6528521 },
                                          mapTypeId: "roadmap",
                                          zoom: 13,
                                        }
                                      );

                                      map.setTilt(45);

                                      // Try HTML5 geolocation to get location
                                      infoWindow = new google.maps.InfoWindow();
                                      geocoder = new google.maps.Geocoder();
                                      var input = document.getElementById("pac-input");

                                      var autocomplete =
                                        new google.maps.places.Autocomplete(input, {
                                          placeIdOnly: true,
                                        });
                                      autocomplete.bindTo("bounds", map);

                                      //
                                      // Try HTML5 geolocation.
                                      if (navigator.geolocation) {
                                        navigator.geolocation.getCurrentPosition(
                                          function (position) {
                                            var pos = {
                                              lat: <%= Scope.latitude %>,
                                              lng: <%= Scope.longitude %>,
                                            };

                                            var marker = new google.maps.Marker({
                                              position: new google.maps.LatLng(pos),
                                              map: map,
                                              draggable: true,
                                              title: "Your position",
                                            });
                                            /*infoWindow.setPosition(pos);
                          infoWindow.setContent('Your position');
                          marker.addListener('click', function() {
                            infoWindow.open(map, marker);
                          });
                          infoWindow.open(map, marker);*/
                                            map.setCenter(pos);

                                            updateMarkerPosition(marker.getPosition());
                                            geocodePosition(pos);

                                            // Add dragging event listeners.
                                            google.maps.event.addListener(
                                              marker,
                                              "dragstart",
                                              function () {
                                                updateMarkerAddress("Dragging...");
                                              }
                                            );

                                            google.maps.event.addListener(
                                              marker,
                                              "drag",
                                              function () {
                                                updateMarkerStatus("Dragging...");
                                                updateMarkerPosition(
                                                  marker.getPosition()
                                                );
                                              }
                                            );

                                            google.maps.event.addListener(
                                              marker,
                                              "dragend",
                                              function () {
                                                updateMarkerStatus("Drag ended");
                                                geocodePosition(marker.getPosition());
                                                map.panTo(marker.getPosition());
                                              }
                                            );

                                            google.maps.event.addListener(
                                              map,
                                              "click",
                                              function (e) {
                                                updateMarkerPosition(e.latLng);
                                                geocodePosition(marker.getPosition());
                                                marker.setPosition(e.latLng);
                                                map.panTo(marker.getPosition());
                                              }
                                            );
                                          },
                                          function () {
                                            handleLocationError(
                                              true,
                                              infoWindow,
                                              map.getCenter()
                                            );
                                          }
                                        );
                                      } else {
                                        // Browser doesn't support Geolocation
                                        handleLocationError(
                                          false,
                                          infoWindow,
                                          map.getCenter()
                                        );
                                      }

                                      //
                                      autocomplete.addListener(
                                        "place_changed",
                                        function () {
                                          var place = autocomplete.getPlace();

                                          if (!place.place_id) {
                                            return;
                                          }
                                          geocoder.geocode(
                                            { placeId: place.place_id },
                                            function (results, status) {
                                              if (status !== "OK") {
                                                window.alert(
                                                  "Geocoder failed due to: " + status
                                                );
                                                return;
                                              }
                                              map.setZoom(13);
                                              map.setCenter(results[0].geometry.location);
                                              // Set the position of the marker using the place ID and location.
                                            }
                                          );
                                        }
                                      );
                                    }

                                    //
                                    function geocodePosition(pos) {
                                      geocoder.geocode(
                                        {
                                          latLng: pos,
                                        },
                                        function (responses) {
                                          if (responses && responses.length > 0) {
                                            updateMarkerAddress(
                                              responses[0].formatted_address
                                            );
                                          } else {
                                            updateMarkerAddress(
                                              "Cannot determine address at this location."
                                            );
                                          }
                                        }
                                      );
                                    }
                                    function updateMarkerStatus(str) {
                                      //  document.getElementById('markerStatus').innerHTML = str;
                                    }
                                    function updateMarkerPosition(latLng) {
                                      $("#latitude").val(latLng.lat());
                                      $("#longitude").val(latLng.lng());
                                    }
                                    function updateMarkerAddress(str) {
                                      $("#address").val(str);
                                    }
                                    function handleLocationError(
                                      browserHasGeolocation,
                                      infoWindow,
                                      pos
                                    ) {
                                      infoWindow.setPosition(pos);
                                      infoWindow.setContent(
                                        browserHasGeolocation
                                          ? "Error: The Geolocation service failed."
                                          : "Error: Your browser doesn't support geolocation."
                                      );
                                      infoWindow.open(map);
                                    }
                        </script>
                        // IMPORTANT NOTE : CHANGE THE API KEY FIRST
                        <script
                          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGU2IkihGELeWGQSzgz0n8yQUvulrmvBM&libraries=places&callback=initMap"
                          async
                          defer
                        ></script>
                      </div>

                      <div class="form-actions">
                        <button
                          type="button"
                          class="btn btn-warning mr-1"
                          onclick="history.back();"
                        >
                          <i class="ft-x"></i> cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                          <i class="la la-check-square-o"></i> Updated
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- // Basic form layout section end -->
      </div>
    </div>
  </div>
</div>

<%- include ('../parts/footer') %>
